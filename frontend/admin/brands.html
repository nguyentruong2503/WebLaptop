<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Branch Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            }
          }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <!-- Header Section -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-4">
      <div>
        <h1 class="text-3xl font-bold text-gray-800">Quản lí nhãn hàng</h1>
        <p class="text-gray-500 mt-1">Thông tin liên hệ các nhãn hàng</p>
      </div>
      
      <div class="flex flex-col sm:flex-row gap-3">
        <form id="searchForm" class="relative">
          <div class="relative">
            <input 
              type="text" 
              placeholder="Search branches..." 
              id="searchInput"
              class="w-full sm:w-64 pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition"
            />
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-search text-gray-400"></i>
            </div>
          </div>
        </form>
        <button 
          onclick="openModal('addModal')" 
          class="flex items-center justify-center gap-2 bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition shadow-sm"
        >
          <i class="fas fa-plus"></i>
          <span>Add Branch</span>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
      <!-- Table -->
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tên nhãn hàng</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Số điện thoại</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Địa chỉ</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
              <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Thao tác</th>
            </tr>
          </thead>
          <tbody id="branchesTable" class="bg-white divide-y divide-gray-200">
            <!-- Data will be inserted here by JS -->
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="hidden p-12 text-center">
        <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
          <i class="fas fa-store text-gray-400 text-3xl"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900 mb-1">No branches found</h3>
        <p class="text-gray-500 mb-4">Get started by adding a new branch</p>
        <button 
          onclick="openModal('addModal')" 
          class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
        >
          <i class="fas fa-plus mr-2"></i> Add Branch
        </button>
      </div>
    </div>
  </div>

  <!-- Add Branch Modal -->
  <div id="addModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md">
      <div class="p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-bold text-gray-800">Add New Branch</h2>
          <button onclick="closeModal('addModal')" class="text-gray-400 hover:text-gray-500">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="addBranchForm">
          <div class="space-y-4">
            <div>
              <label for="add-name" class="block text-sm font-medium text-gray-700 mb-1">Tên nhãn hàng</label>
              <input 
                id="add-name"
                type="text" 
                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" 
                placeholder="Enter branch name" 
                name="nameOfBranch" 
                required 
              />
            </div>
            <div>
              <label for="add-phone" class="block text-sm font-medium text-gray-700 mb-1">Số điện thoại</label>
              <input 
                id="add-phone"
                type="text" 
                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" 
                placeholder="Enter phone number" 
                name="phone" 
                required 
              />
            </div>
            <div>
              <label for="add-address" class="block text-sm font-medium text-gray-700 mb-1">Địa chỉ</label>
              <input 
                id="add-address"
                type="text" 
                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" 
                placeholder="Enter address" 
                name="address" 
                required 
              />
            </div>
            <div>
              <label for="add-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <input 
                id="add-email"
                type="email" 
                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" 
                placeholder="Enter email" 
                name="email" 
                required 
              />
            </div>
          </div>
          <div class="mt-6 flex justify-end space-x-3">
            <button 
              type="button" 
              onclick="closeModal('addModal')" 
              class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition"
            >
              Cancel
            </button>
            <button 
              type="submit" 
              class="px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition"
            >
              Save Branch
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Branch Modal -->
  <div id="editModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md">
      <div class="p-6">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-xl font-bold text-gray-800">Edit Branch</h2>
          <button onclick="closeModal('editModal')" class="text-gray-400 hover:text-gray-500">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <form id="editBranchForm">
          <input type="hidden" name="id" />
          <div class="space-y-4">
            <div>
              <label for="edit-name" class="block text-sm font-medium text-gray-700 mb-1">Tên nhãn hàng</label>
              <input 
                id="edit-name"
                type="text" 
                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" 
                placeholder="Enter branch name" 
                name="nameOfBranch" 
                required 
              />
            </div>
            <div>
              <label for="edit-phone" class="block text-sm font-medium text-gray-700 mb-1">Số điện thoại</label>
              <input 
                id="edit-phone"
                type="text" 
                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" 
                placeholder="Enter phone number" 
                name="phone" 
                required 
              />
            </div>
            <div>
              <label for="edit-address" class="block text-sm font-medium text-gray-700 mb-1">Địa chỉ</label>
              <input 
                id="edit-address"
                type="text" 
                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" 
                placeholder="Enter address" 
                name="address" 
                required 
              />
            </div>
            <div>
              <label for="edit-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
              <input 
                id="edit-email"
                type="email" 
                class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" 
                placeholder="Enter email" 
                name="email" 
                required 
              />
            </div>
          </div>
          <div class="mt-6 flex justify-end space-x-3">
            <button 
              type="button" 
              onclick="closeModal('editModal')" 
              class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition"
            >
              Cancel
            </button>
            <button 
              type="submit" 
              class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
            >
              Update Branch
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    const apiUrl = 'http://localhost:8000/api/brands';
    let branches = [];
    let editingId = null;

    function openModal(id) {
      document.getElementById(id).classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
    }
    
    function closeModal(id) {
      document.getElementById(id).classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
    }

    function renderTable(data) {
      const tbody = document.getElementById('branchesTable');
      const emptyState = document.getElementById('emptyState');
      
      if (data.length === 0) {
        tbody.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }
      
      emptyState.classList.add('hidden');
      tbody.innerHTML = '';
      
      data.forEach((row) => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50 transition';
        tr.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${row.id}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 font-medium">${row.nameOfBranch}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${row.phone}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${row.address}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${row.email}</td>
          <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
            <div class="flex items-center justify-end space-x-3">
              <button onclick='openEditModal(${JSON.stringify(row)})' class="text-primary-600 hover:text-primary-800 transition" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button onclick='deleteBranch(${row.id})' class="text-red-600 hover:text-red-800 transition" title="Delete">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function fetchBranches(query = '') {
      let url = apiUrl;
      if (query) url += `?search=${encodeURIComponent(query)}`;
      
      try {
        const res = await fetch(url);
        branches = await res.json();
        renderTable(branches);
      } catch (error) {
        console.error('Error fetching branches:', error);
      }
    }

    document.getElementById('searchForm').onsubmit = e => {
      e.preventDefault();
      fetchBranches(document.getElementById('searchInput').value);
    };
    
    document.getElementById('searchInput').oninput = function() {
      fetchBranches(this.value);
    };

    document.getElementById('addBranchForm').onsubmit = async function(e) {
      e.preventDefault();
      const form = e.target;
      const data = Object.fromEntries(new FormData(form));
      
      try {
        await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        closeModal('addModal');
        form.reset();
        fetchBranches();
      } catch (error) {
        console.error('Error adding branch:', error);
      }
    };

    function openEditModal(row) {
      editingId = row.id;
      const form = document.getElementById('editBranchForm');
      form.nameOfBranch.value = row.nameOfBranch;
      form.phone.value = row.phone;
      form.address.value = row.address;
      form.email.value = row.email;
      form.id.value = row.id;
      openModal('editModal');
    }

    document.getElementById('editBranchForm').onsubmit = async function(e) {
      e.preventDefault();
      const form = e.target;
      const data = Object.fromEntries(new FormData(form));
      
      try {
        await fetch(`${apiUrl}/${editingId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        closeModal('editModal');
        fetchBranches();
      } catch (error) {
        console.error('Error updating branch:', error);
      }
    };

    async function deleteBranch(id) {
      if (!confirm('Are you sure you want to delete this branch?')) return;
      
      try {
        await fetch(`${apiUrl}/${id}`, { method: 'DELETE' });
        fetchBranches();
      } catch (error) {
        console.error('Error deleting branch:', error);
      }
    }

    // Initial load
    fetchBranches();
  </script>
</body>
</html>